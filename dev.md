# Drone with Jenkins-style 开发规划

截止2019年4月30日，已将`Drone`的基本逻辑和处理思路整理清楚，并做了相关验证。

接下来，将会对 `Drone` 进行一些改造使其能够更加灵活地满足我们的需求(Jenkins-style)。

我们要做的改动如下:
- [ ] 增加添加用户接口,使得我们能够通过接口添加`Token`而无需调用`OAuth认证`,原则上讲`OAuth认证`更合理。
- [ ] 管理项目,项目的添加者才能管理项目
- [ ] 管理构建,项目的添加者才能管理构建

### 20190506

- [ ] 决定还是采用OAuth认证方式, Drone没有提供 Private Token 的支持, 增加这个支持改动比较大.
- [ ] 通过上层应用获取到用户信息和 Token,然后触发Drone的更新.
- [ ] 通过 syncer 来同步项目


### 20190507

- [ ] OAuth方案也存在问题，无法同步多个(种)数据仓库

**先不处理需要全新认证的情况**


### 20190508

- [ ] 同步项目接口


### 20190509

- [ ] 列出所有用户包含 token
- [ ] 日志查询接口


#### 主要过程


|打包流程|Drone流程|
| :----- | :------ |
|接口添加或数据库同步项目|查找项目的可选用户|
||没有可用用户，返回错误，通知认证|
||认证结束后需要再次将同步失败的项目进行重新处理|
||根据项目`lable`更新项目的 `config_path`，并维护 pipeline 的数据 |
|提交构建|项目不存在|
||查询项目的的管理用户(一定存在)|
||使用该token进行提交构建|

